{"version":3,"file":"schema.js","names":["Table","sqldiff","View","SIMPLE_TYPES","Schema","form","columns","options","prefix","elements","Utils","flattenElements","schemaElements","DataElements","find","buildSchema","calculatedFieldDateFormat","tables","views","formTable","buildFormTable","valuesTable","buildValuesTable","push","buildDataColumns","buildViews","buildIndexes","alias","part","escapePart","partName","escapeDataName","escapeSlashes","name","dataName","replace","table","format","row_id","type","form_id","id","systemFormTableColumns","column","formColumn","clone","system","maybeComplexType","addColumn","onAddFormTable","schema","systemValuesTableColumns","valueColumn","buildRepeatableTable","parentTable","element","key","parent","data_name","systemRepeatableTableColumns","attrs","onAddRepeatableTable","processElement","viewColumns","systemFormViewColumns","view","buildViewForTable","fullView","variant","columnNames","viewColumnName","projection","escapeIdentifier","raw","indexDefinitions","systemFormTableIndexes","systemRepeatableTableIndexes","systemValuesTableIndexes","index","indexDefinition","isComplex","method","skip","disableComplexTypes","addIndex","systemFormFullViewColumns","systemRepeatableFullViewColumns","systemRepeatableViewColumns","systemValuesViewColumns","suffix","launderViewColumnName","count","rawName","substring","toLowerCase","newName","toString","length","elementTable","numeric","addDoubleElement","addStringElement","multiple","addArrayElement","addMediaElement","addTimestampElement","addDateElement","addTimeElement","addRepeatableElement","addRecordLinkElement","display","style","addBooleanElement","console","log","addStringColumn","addElement","addIntegerElement","dataType","disableArrays","indexOf","includeMediaCaptions","includeMediaURLs","includeMediaViewURLs","value","clause","filter","PhotoField","VideoField","AudioField","AttachmentField","childTable","childElements","childElement"],"sources":["../src/schema.js"],"sourcesContent":["import { clone } from 'lodash';\nimport Utils from './utils';\nimport sqldiff from 'sqldiff';\nimport {format} from 'util';\nimport DataElements from './data-elements';\n\nconst {Table, View} = sqldiff;\n\nconst SIMPLE_TYPES = [\n  'pk',\n  'text',\n  'string',\n  'date',\n  'time',\n  'timestamp',\n  'double',\n  'integer',\n  'boolean'\n];\n\nexport default class Schema {\n  constructor(form, columns, options) {\n    this.prefix = 'f';\n    this.form = form;\n    this.columns = columns;\n    this.options = options || {};\n    this.elements = Utils.flattenElements(this.form.elements, false);\n    this.schemaElements = DataElements.find(this.elements);\n    this.buildSchema();\n\n    columns.calculatedFieldDateFormat = columns.calculatedFieldDateFormat === 'date' ? 'date' : 'double';\n  }\n\n  buildSchema() {\n    this.tables = [];\n    this.views = [];\n\n    this.formTable = this.buildFormTable();\n    this.valuesTable = this.buildValuesTable();\n\n    this.tables.push(this.formTable);\n    this.tables.push(this.valuesTable);\n\n    this.buildDataColumns();\n\n    this.buildViews();\n\n    this.buildIndexes();\n  }\n\n  alias(part, escapePart = true) {\n    if (part) {\n      const partName = escapePart ? this.escapeDataName(part) : part;\n\n      return this.escapeSlashes(this.form.name) + '/' + this.escapeSlashes(partName);\n    }\n    return this.escapeSlashes(this.form.name);\n  }\n\n  escapeDataName(dataName) {\n    // if a data name starts with an underscore, add an additional underscore to prevent\n    // collisions with future system-defined columns. e.g. `_symbol` becomes `__symbol`\n    // because at some point we might add a system column named `symbol` which needs the\n    // `_symbol` name.\n    if (dataName && dataName[0] === '_') {\n      return '_' + dataName;\n    }\n\n    return dataName || 'no_data_name';\n  }\n\n  escapeSlashes(name) {\n    return name.replace(/\\//g, '\\\\/');\n  }\n\n  buildFormTable() {\n    const table = new Table(format('form_%s', this.form.row_id),\n                            null,\n                            {type: 'form', alias: this.alias(), form_id: this.form.id});\n\n    for (const column of this.columns.systemFormTableColumns) {\n      const formColumn = clone(column);\n\n      formColumn.system = true;\n      formColumn.type = this.maybeComplexType(formColumn.type);\n\n      table.addColumn(formColumn);\n    }\n\n    if (this.options.onAddFormTable) {\n      this.options.onAddFormTable({table, form: this.form, schema: this});\n    }\n\n    return table;\n  }\n\n  buildValuesTable() {\n    const table = new Table(format('form_%s_values', this.form.row_id),\n                            null,\n                            {type: 'values', alias: this.alias('values'), form_id: this.form.id});\n\n    for (const column of this.columns.systemValuesTableColumns) {\n      const valueColumn = clone(column);\n\n      valueColumn.system = true;\n      valueColumn.type = this.maybeComplexType(valueColumn.type);\n\n      table.addColumn(valueColumn);\n    }\n\n    return table;\n  }\n\n  buildRepeatableTable(parentTable, element) {\n    const table = new Table(this.formTable.id + '_' + element.key,\n                            null,\n                            {type: 'repeatable', parent: parentTable, element: element, alias: this.alias(element.data_name), form_id: this.form.id});\n\n    for (const column of this.columns.systemRepeatableTableColumns) {\n      const attrs = clone(column);\n\n      attrs.id = element.key + '_' + column.name;\n      attrs.system = true;\n      attrs.type = this.maybeComplexType(attrs.type);\n\n      table.addColumn(attrs);\n    }\n\n    if (this.options.onAddRepeatableTable) {\n      this.options.onAddRepeatableTable({table, parentTable, element, form: this.form, schema: this});\n    }\n\n    return table;\n  }\n\n  buildDataColumns() {\n    for (const element of this.schemaElements) {\n      this.processElement(element, this.formTable);\n    }\n  }\n\n  buildViews() {\n    this.viewColumns = {};\n\n    if (!this.columns.systemFormViewColumns) {\n      return;\n    }\n\n    for (const table of this.tables) {\n      const view = new View(table.name + '_view', null, table);\n\n      this.buildViewForTable(table, view);\n\n      this.views.push(view);\n\n      if (table.type === 'form') {\n        const fullView = new View(table.name + '_view_full', null, table, {variant: 'full', alias: this.alias('_full', false)});\n\n        this.buildViewForTable(table, fullView);\n\n        this.views.push(fullView);\n      } else if (table.type === 'repeatable') {\n        const fullView = new View(table.name + '_view_full', null, table, {variant: 'full',\n                                                                           alias: this.alias(table.element.data_name) + '/_full'});\n\n        this.buildViewForTable(table, fullView);\n\n        this.views.push(fullView);\n      }\n    }\n  }\n\n  buildViewForTable(table, view) {\n    const columnNames = {};\n\n    for (const column of table.columns) {\n      const alias = this.viewColumnName(view, table, column);\n\n      if (alias == null) {\n        continue;\n      }\n\n      if (!columnNames[alias]) {\n        if (column.type === 'boolean') {\n          const projection = `${column.name} IS NOT NULL AND ${column.name} = 't' AS ${Utils.escapeIdentifier(alias)}`;\n          view.addColumn({column: column, alias: alias, raw: projection});\n        } else {\n          view.addColumn({column: column, alias: alias});\n        }\n\n        columnNames[alias] = column;\n      }\n    }\n  }\n\n  buildIndexes() {\n    for (const table of this.tables) {\n      let indexDefinitions = [];\n\n      if (table.type === 'form') {\n        indexDefinitions = this.columns.systemFormTableIndexes;\n      } else if (table.type === 'repeatable') {\n        indexDefinitions = this.columns.systemRepeatableTableIndexes;\n      } else if (table.type === 'values') {\n        indexDefinitions = this.columns.systemValuesTableIndexes;\n      }\n\n      for (const index of indexDefinitions) {\n        const indexDefinition = clone(index);\n\n        const isComplex = indexDefinition.method === 'gist' || indexDefinition.method === 'gin';\n\n        const skip = isComplex && this.columns.disableComplexTypes === true;\n\n        if (!skip) {\n          table.addIndex(indexDefinition);\n        }\n      }\n    }\n  }\n\n  viewColumnName(view, table, column) {\n    let name = null;\n\n    if (column.system) {\n      if (table.type === 'form') {\n        if (view.variant === 'full') {\n          name = this.columns.systemFormFullViewColumns[column.name];\n        } else {\n          name = this.columns.systemFormViewColumns[column.name];\n        }\n      } else if (table.type === 'repeatable') {\n        if (view.variant === 'full') {\n          name = this.columns.systemRepeatableFullViewColumns[column.name];\n        } else {\n          name = this.columns.systemRepeatableViewColumns[column.name];\n        }\n      } else if (table.type === 'values') {\n        name = this.columns.systemValuesViewColumns[column.name];\n      }\n\n      if (name == null) {\n        return null;\n      }\n\n      name = '_' + name;\n    } else if (column.element) {\n      name = this.escapeDataName(column.element.data_name) + (column.suffix || '');\n    } else {\n      name = column.name + (column.suffix || '');\n    }\n\n    if (name) {\n      // dedupe any columns\n      name = this.launderViewColumnName(view, column, name);\n    }\n\n    return name;\n  }\n\n  launderViewColumnName(view, column, name) {\n    const views = this.viewColumns;\n\n    views[view.name] = views[view.name] || {};\n\n    let count = 1;\n\n    const rawName = name.substring(0, 63).toLowerCase();\n    let newName = rawName;\n\n    while (views[view.name][newName]) {\n      newName = rawName.substring(0, 63 - (count.toString().length)) + count;\n      count++;\n    }\n\n    views[view.name][newName] = column;\n\n    return newName;\n  }\n\n  processElement(element, elementTable) {\n    switch (element.type) {\n      case 'TextField':\n        if (element.numeric) {\n          this.addDoubleElement(elementTable, element);\n        } else {\n          this.addStringElement(elementTable, element);\n        }\n        break;\n\n      case 'ChoiceField':\n        if (element.multiple) {\n          this.addArrayElement(elementTable, element);\n        } else {\n          this.addStringElement(elementTable, element);\n        }\n        break;\n\n      case 'ClassificationField':\n        this.addArrayElement(elementTable, element);\n        break;\n\n      case 'YesNoField':\n        this.addStringElement(elementTable, element);\n        break;\n\n      case 'PhotoField':\n      case 'VideoField':\n      case 'AudioField':\n      case 'AttachmentField':\n        this.addMediaElement(elementTable, element);\n        break;\n\n      case 'SignatureField':\n        this.addStringElement(elementTable, element);\n        this.addTimestampElement(elementTable, element, 'timestamp');\n        break;\n\n      case 'BarcodeField':\n        this.addStringElement(elementTable, element);\n        break;\n\n      case 'DateTimeField':\n      case 'DateField':\n        this.addDateElement(elementTable, element);\n        break;\n\n      case 'TimeField':\n        this.addTimeElement(elementTable, element);\n        break;\n\n      case 'Repeatable':\n        this.addRepeatableElement(elementTable, element);\n        break;\n\n      case 'AddressField':\n        this.addStringElement(elementTable, element);\n        this.addStringElement(elementTable, element, 'sub_thoroughfare');\n        this.addStringElement(elementTable, element, 'thoroughfare');\n        this.addStringElement(elementTable, element, 'suite');\n        this.addStringElement(elementTable, element, 'locality');\n        this.addStringElement(elementTable, element, 'admin_area');\n        this.addStringElement(elementTable, element, 'postal_code');\n        this.addStringElement(elementTable, element, 'sub_admin_area');\n        this.addStringElement(elementTable, element, 'country');\n        break;\n\n      case 'HyperlinkField':\n        this.addStringElement(elementTable, element);\n        break;\n\n      case 'RecordLinkField':\n        this.addRecordLinkElement(elementTable, element);\n        break;\n\n      case 'CalculatedField':\n        switch (element.display.style) {\n          case 'date':\n            if (this.columns.calculatedFieldDateFormat === 'date') {\n              this.addDateElement(elementTable, element);\n            } else {\n              this.addDoubleElement(elementTable, element);\n            }\n            break;\n          case 'number':\n          case 'currency':\n            this.addDoubleElement(elementTable, element);\n            break;\n          default:\n            this.addStringElement(elementTable, element);\n            break;\n        }\n        break;\n\n      case 'CheckboxField':\n        this.addBooleanElement(elementTable, element);\n        break;\n\n      case 'DynamicField':\n        this.addArrayElement(elementTable, element, 'metadata');\n        this.addArrayElement(elementTable, element, 'elements');\n        this.addArrayElement(elementTable, element, 'values');\n        break;\n\n      case 'LocationField':\n        this.addDoubleElement(elementTable, element, 'latitude');\n        this.addDoubleElement(elementTable, element, 'longitude');\n        this.addStringElement(elementTable, element, 'address');\n        break;\n\n      default:\n        console.log('Unhandled element type', element.type);\n        break;\n    }\n  }\n\n  addStringColumn(table, name, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addColumn(table, name, 'string', suffix);\n  }\n\n  addStringElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'string', suffix);\n  }\n\n  addDateElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'date', suffix);\n  }\n\n  addTimeElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'time', suffix);\n  }\n\n  addTimestampElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'timestamp', suffix);\n  }\n\n  addDoubleElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'double', suffix);\n  }\n\n  addBooleanElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'boolean', suffix);\n  }\n\n  addIntegerElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n    return this.addElement(table, element, 'integer', suffix);\n  }\n\n  addArrayElement(table, element, suffix) {\n    if (suffix == null) {\n      suffix = '';\n    }\n\n    const dataType = this.columns.disableArrays === true ? 'string' : 'array';\n\n    return this.addElement(table, element, dataType, suffix);\n  }\n\n  addColumn(table, name, type, suffix) {\n    let column = null;\n\n    if (suffix == null) {\n      suffix = '';\n    }\n\n    if (suffix) {\n      suffix = '_' + suffix;\n    }\n\n    column = {\n      id: name + suffix,\n      type: this.maybeComplexType(type),\n      element: null,\n      suffix: suffix\n    };\n\n    table.addColumn(column);\n  }\n\n  addElement(table, element, type, suffix) {\n    let column = null;\n\n    if (suffix == null) {\n      suffix = '';\n    }\n\n    if (suffix) {\n      suffix = '_' + suffix;\n    }\n\n    column = {\n      id: this.prefix + element.key + suffix,\n      type: this.maybeComplexType(type),\n      element: element,\n      suffix: suffix\n    };\n\n    table.addColumn(column);\n  }\n\n  maybeComplexType(type) {\n    const isComplex = SIMPLE_TYPES.indexOf(type) === -1;\n\n    return isComplex && this.columns.disableComplexTypes === true ? 'string' : type;\n  }\n\n  addMediaElement(table, element) {\n    this.addArrayElement(table, element);\n\n    if (element.type !== 'AttachmentField') {\n      if (this.columns.includeMediaCaptions !== false) {\n        this.addArrayElement(table, element, 'captions');\n      }\n\n      if (this.columns.includeMediaURLs) {\n        this.addArrayElement(table, element, 'urls');\n      }\n\n      if (this.columns.includeMediaViewURLs) {\n        this.addStringElement(table, element, 'view_url');\n      }\n    }\n\n    if (element.type === 'AttachmentField') {\n      this.addArrayElement(table, element, 'names');\n    }\n\n    if (!this.columns.systemFormViewColumns) {\n      return;\n    }\n\n    const value = element.key.replace(/'/g, \"''\");\n\n    const clause = format('WHERE key = \\'%s\\'', value);\n\n    const filter = {\n      key: value\n    };\n\n    const alias = {\n      PhotoField: '_photo_id',\n      VideoField: '_video_id',\n      AudioField: '_audio_id',\n      AttachmentField: '_attachment_id'\n    }[element.type];\n\n    if (alias) {\n      const view = new View(this.formTable.id + '_' + element.key + '_view',\n                            null, this.valuesTable, {type: 'media', element: element, clause: clause, filter, alias: this.alias(element.data_name)});\n\n      view.addColumn({column: {name: 'record_resource_id', type: 'string'}, alias: 'record_id'});\n      view.addColumn({column: {name: 'parent_resource_id', type: 'string'}, alias: 'parent_id'});\n      view.addColumn({column: {name: 'text_value', type: 'string'}, alias: alias});\n\n      this.views.push(view);\n    }\n  }\n\n  addRecordLinkElement(parentTable, element) {\n    this.addArrayElement(parentTable, element);\n\n    if (!this.columns.systemFormViewColumns) {\n      return;\n    }\n\n    const value = element.key.replace(/'/g, \"''\");\n\n    const clause = format('WHERE key = \\'%s\\'', value);\n\n    const view = new View(this.formTable.id + '_' + element.key + '_view',\n                          null, this.valuesTable, {type: 'link', element: element, clause: clause, alias: this.alias(element.data_name)});\n\n    view.addColumn({column: {name: 'record_resource_id', type: 'string'}, alias: 'source_record_id'});\n    view.addColumn({column: {name: 'parent_resource_id', type: 'string'}, alias: 'parent_id'});\n    view.addColumn({column: {name: 'text_value', type: 'string'}, alias: 'linked_record_id'});\n\n    this.views.push(view);\n  }\n\n  addRepeatableElement(parentTable, element) {\n    const childTable = this.buildRepeatableTable(parentTable, element);\n\n    this.tables.push(childTable);\n\n    const elements = Utils.flattenElements(element.elements, false);\n\n    const childElements = DataElements.find(elements);\n\n    for (const childElement of childElements) {\n      this.processElement(childElement, childTable);\n    }\n  }\n}\n"],"mappings":"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"}